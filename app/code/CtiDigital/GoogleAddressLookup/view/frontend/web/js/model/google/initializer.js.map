{"version":3,"sources":["frontend/web/js/model/google/initializer.js"],"names":["define","addressData","Initializer","el","Strategy","scope","init","form","getForm","initAutocomplete","instance","google","maps","places","Autocomplete","types","country","setComponentRestrictions","subscribe","addListener","fillInAddress","eChange","Event","dispatchEvent","place","getPlace","geometry","strategy","newAddressData","getAddressData","address","isShowDetails"],"mappings":";;;;;;AAAA;;;;AAIAA,OAAO,CACH,+CADG,CAAP,EAEG,UAAUC,WAAV,EAAuB;AACtB;;AADsB,QAGhBC,WAHgB;AAIlB;;;;;;AAMA,6BAAYC,EAAZ,EAAgBC,QAAhB,EAA0BC,KAA1B,EAA8C;AAAA,gBAAbC,IAAa,uEAAN,IAAM;;AAAA;;AAC1C,iBAAKH,EAAL,GAAUA,EAAV;AACA,iBAAKC,QAAL,GAAgBA,QAAhB;AACA,iBAAKG,IAAL,GAAaN,YAAYO,OAAZ,CAAoBH,KAApB,CAAb;;AAEA,gBAAIC,IAAJ,EAAU;AACN,qBAAKG,gBAAL,CAAsBN,EAAtB;AACH;AACJ;;AAED;;;;;;;AApBkB;AAAA;AAAA,6CAyBDA,EAzBC,EAyBG;AAAA;;AACjB,oBAAMO,WAAW,IAAIC,OAAOC,IAAP,CAAYC,MAAZ,CAAmBC,YAAvB,CAAoCX,EAApC,EAAwC,EAACY,OAAO,CAAC,SAAD,CAAR,EAAxC,CAAjB;AACA,oBAAI,KAAKR,IAAL,CAAUS,OAAV,EAAJ,EAAyB;AACrBN,6BAASO,wBAAT,CAAkC,EAAC,WAAW,KAAKV,IAAL,CAAUS,OAAV,EAAZ,EAAlC;AACH;;AAED,qBAAKT,IAAL,CAAUS,OAAV,CAAkBE,SAAlB,CAA4B,UAACF,OAAD,EAAa;AACrCN,6BAASO,wBAAT,CAAkC,EAAC,WAAWD,OAAZ,EAAlC;AACH,iBAFD;;AAIAN,yBAASS,WAAT,CAAqB,eAArB,EAAqC,YAAM;AACvC,0BAAKC,aAAL,CAAmBV,QAAnB;AACA,wBAAMW,UAAU,IAAIC,KAAJ,CAAU,QAAV,CAAhB;AACAnB,uBAAGoB,aAAH,CAAiBF,OAAjB;AACH,iBAJD;AAKH;AAxCiB;AAAA;;;AA0ClB;;;AA1CkB,0CA6CJX,QA7CI,EA6CM;AACpB,oBAAMc,QAAQd,SAASe,QAAT,EAAd;AACA,oBAAI,CAACD,MAAME,QAAX,EAAqB;AACjB;AACH;;AAED,oBAAMC,WAAW,IAAI,KAAKvB,QAAT,CAAkBoB,KAAlB,CAAjB;AACA,oBAAMI,iBAAiBD,SAASE,cAAT,EAAvB;;AAEA,oBAAID,cAAJ,EAAoB;AAChB,yBAAKrB,IAAL,CAAUuB,OAAV,CAAkBF,cAAlB;AACA,yBAAKrB,IAAL,CAAUwB,aAAV,CAAwB,IAAxB;AACH;AACJ;AA1DiB;;AAAA;AAAA;;AA6DtB,WAAO7B,WAAP;AACH,CAhED","file":"initializer.js","sourcesContent":["/**\n * @author Bartosz Herba <b.herba@ctidigital.com>\n * @copyright 2017 CtiDigital Sp. z o.o.\n */\ndefine([\n    'GoogleAddressLookup/model/address/addressData',\n], function (addressData) {\n    \"use strict\";\n\n    class Initializer {\n        /**\n         * @param {element} el\n         * @param Strategy\n         * @param {string} scope\n         * @param {bool} init\n         */\n        constructor(el, Strategy, scope, init = true) {\n            this.el = el;\n            this.Strategy = Strategy;\n            this.form =  addressData.getForm(scope);\n\n            if (init) {\n                this.initAutocomplete(el);\n            }\n        }\n\n        /**\n         * Initializes google place autocomplete.\n         *\n         * @param {element} el\n         */\n        initAutocomplete(el) {\n            const instance = new google.maps.places.Autocomplete(el, {types: ['address']});\n            if (this.form.country()) {\n                instance.setComponentRestrictions({'country': this.form.country()});\n            }\n\n            this.form.country.subscribe((country) => {\n                instance.setComponentRestrictions({'country': country});\n            });\n\n            instance.addListener('place_changed',() => {\n                this.fillInAddress(instance);\n                const eChange = new Event('change');\n                el.dispatchEvent(eChange);\n            });\n        };\n\n        /**\n         * @param {object} instance\n         */\n        fillInAddress(instance) {\n            const place = instance.getPlace();\n            if (!place.geometry) {\n                return;\n            }\n\n            const strategy = new this.Strategy(place);\n            const newAddressData = strategy.getAddressData();\n\n            if (newAddressData) {\n                this.form.address(newAddressData);\n                this.form.isShowDetails(true);\n            }\n        }\n    }\n\n    return Initializer;\n});\n"]}